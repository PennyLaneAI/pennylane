name: "RTD check"
on:
  pull_request: {}

jobs:
  sphinx:
    runs-on: ${{ fromJson(steps.read_rtd.outputs.content).build.os }}
    env:
      PYTHON_VERSION: ${{ fromJson(steps.read_rtd.outputs.content).python.version }}
    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: Setup Python
      id: setup_python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Install dependencies
      run: |
        pip install --upgrade --no-cache-dir pip setuptools 
        pip install --upgrade --no-cache-dir sphinx graphviz
        pip install --exists-action=w --no-cache-dir -r doc/requirements.txt   
        pip install --upgrade --upgrade-strategy only-if-needed --no-cache-dir  .     
 

    - name: Build Sphinx
      run: |
        cd doc
        python -m sphinx -T -b html -d ./_build/doctrees -D language=en . ./html --keep-going -c 
