:orphan:

# Release 0.34.0-dev (development release)

<h3>New features since last release</h3>

<h4>Decompose circuits into the Clifford+T gateset üß©</h4>

* `qml.transforms.decompositions.sk_decomposition` method implements the Solovay-Kitaev algorithm for
  approximately decomposing any single-qubit operation to Clifford+T basis.
  [(#4801)](https://github.com/PennyLaneAI/pennylane/pull/4801)

<h4>Transforms (TODO: better title) ü§ñ</h4>

<h4>Use an iterative approach for quantum phase estimation üîÑ</h4>

* Iterative Quantum Phase Estimation is now available from `qml.iterative_qpe`.
  [(#4804)](https://github.com/PennyLaneAI/pennylane/pull/4804)

  The subroutine can be used similarly to mid-circuit measurements: 

  ```python
  
  import pennylane as qml
  
  dev = qml.device("default.qubit", shots = 5)

  @qml.qnode(dev)
  def circuit():

    # Initial state
    qml.PauliX(wires = [0])

    # Iterative QPE
    measurements = qml.iterative_qpe(qml.RZ(2., wires = [0]), ancilla = [1], iters = 3)

    return [qml.sample(op = meas) for meas in measurements]
  ```
  
  ```pycon
  >>> print(circuit())
  [array([0, 0, 0, 0, 0]), array([1, 0, 0, 0, 0]), array([0, 1, 1, 1, 1])]
  ```
  
  The i-th element in the list refers to the 5 samples generated by the i-th measurement of the algorithm.

<h4>Drawing and statistics for mid-circuit measurements üé®</h4>

* `qml.draw` now supports drawing mid-circuit measurements and conditional operators.
  [(#4775)](https://github.com/PennyLaneAI/pennylane/pull/4775)
  [(#4803)](https://github.com/PennyLaneAI/pennylane/pull/4803)

<h4>Catalyst is seamlessly integrated with PennyLane ‚öóÔ∏è</h4>

* The `qml.compiler` module provides support for hybrid quantum-classical compilation.
  [(#4692)](https://github.com/PennyLaneAI/pennylane/pull/4692)

  Through the use of the `qml.qjit` decorator, entire workflows can be just-in-time (JIT)
  compiled --- including both quantum and classical processing --- down to a machine binary on
  first function execution. Subsequent calls to the compiled function will execute
  the previously-compiled binary, resulting in significant performance improvements.

  ``` python
  import pennylane as qml

  dev = qml.device("lightning.qubit", wires=2)

  @qml.qjit
  @qml.qnode(dev)
  def circuit(theta):
      qml.Hadamard(wires=0)
      qml.RX(theta, wires=1)
      qml.CNOT(wires=[0,1])
      return qml.expval(qml.PauliZ(wires=1))
  ```

  ``` pycon
  >>> circuit(0.5)  # the first call, compilation occurs here
  array(0.)
  >>> circuit(0.5)  # the precompiled quantum function is called
  array(0.)
  ```

  Currently, PennyLane supports the [Catalyst hybrid compiler](https://github.com/pennylaneai/catalyst)
  hybrid compiler with the `qml.qjit` decorator. A significant benefit of Catalyst
  is the ability to preserve complex control flow around quantum operations ‚Äî such as
  if statements and for loops, and including measurement feedback ‚Äî during compilation,
  while continuing to support end-to-end autodifferentiation.

* `qml.grad` and `qml.jacobian` can be used with the `qml.qjit` decorator.
  [(#4709)](https://github.com/PennyLaneAI/pennylane/pull/4709)

  When these functions are used with `qml.qjit`, they are patched to
  [catalyst.grad](https://docs.pennylane.ai/projects/catalyst/en/stable/code/api/catalyst.grad.html) and
  [catalyst.jacobian](https://docs.pennylane.ai/projects/catalyst/en/stable/code/api/catalyst.jacobian.html).

  ``` python
  dev = qml.device("lightning.qubit", wires=1)

  @qml.qjit
  def workflow(x):

      @qml.qnode(dev)
      def circuit(x):
          qml.RX(np.pi * x[0], wires=0)
          qml.RY(x[1], wires=0)
          return qml.probs()

      g = qml.jacobian(circuit)

      return g(x)
  ```

  ``` pycon
    >>> workflow(np.array([2.0, 1.0]))
    array([[-1.32116540e-07,  1.33781874e-07],
           [-4.20735506e-01,  4.20735506e-01]])
  ```

<h3>Improvements üõ†</h3>

* `qml.expval` with large `Hamiltonian` objects is now faster and has a significantly lower memory footprint (and constant with respect to the number of `Hamiltonian` terms) when the `Hamiltonian` is a `PauliSentence`. That is due to the introduction of a specialized `dot` method in the `PauliSentence` class which performs `PauliSentence`-`state` products.
  [(#4839)](https://github.com/PennyLaneAI/pennylane/pull/4839)

<h4>Community contributions ü•≥</h4>

* Approximate Quantum Fourier Transform (AQFT) is now available from `qml.AQFT`.
  [(#4715)](https://github.com/PennyLaneAI/pennylane/pull/4715)

* `qml.draw` and `qml.draw_mpl` now render operator ids.
  [(#4749)](https://github.com/PennyLaneAI/pennylane/pull/4749)

* The function ``qml.equal`` now supports ``ControlledSequence`` operators.
  [(#4829)](https://github.com/PennyLaneAI/pennylane/pull/4829)

* XZX decomposition is added to the list of supported single-qubit unitary decompositions.
  [(#4862)](https://github.com/PennyLaneAI/pennylane/pull/4862)

* Non-parametric-ops such as `Barrier`, `Snapshot` and `Wirecut` have been grouped together and moved to `pennylane/ops/meta.py`.
  Additionally, the relevant tests have been organized and placed in a new file, `tests/ops/test_meta.py` .
  [(#4789)](https://github.com/PennyLaneAI/pennylane/pull/4789)

<h4>Better support for batching</h4>

* `default.qubit` now can evolve already batched states with `ParametrizedEvolution`
  [(#4863)](https://github.com/PennyLaneAI/pennylane/pull/4863)

* `AmplitudeEmbedding` now also supports batching when used with Tensorflow.
  [(#4818)](https://github.com/PennyLaneAI/pennylane/pull/4818)

* `qml.draw` and `qml.draw_mpl` now support drawing mid-circuit measurements.
  [(#4775)](https://github.com/PennyLaneAI/pennylane/pull/4775)
  [(#4832)](https://github.com/PennyLaneAI/pennylane/pull/4832)

* `qml.ArbitraryUnitary` now supports batching.
  [(#4745)](https://github.com/PennyLaneAI/pennylane/pull/4745)

<h4>Performance improvements and benchmarking</h4>

* `default.qubit` no longer uses a dense matrix for `MultiControlledX` for more than 8 operation wires.
  [(#4673)](https://github.com/PennyLaneAI/pennylane/pull/4673)

* Autograd and torch can now use vjps provided by the device from the new device API. If a device provides
  a vector Jacobian product, this can be selected by providing `device_vjp=True` to
  `qml.execute`.
  [(#4557)](https://github.com/PennyLaneAI/pennylane/pull/4557)
  [(#4654)](https://github.com/PennyLaneAI/pennylane/pull/4654)

* Updates to some relevant Pytests to enable its use as a suite of benchmarks.
  [(#4703)](https://github.com/PennyLaneAI/pennylane/pull/4703)

* Added `__iadd__` method to PauliSentence, which enables inplace-addition using `+=`, we no longer need to perform a copy, leading to performance improvements.
  [(#4662)](https://github.com/PennyLaneAI/pennylane/pull/4662) 

* `default.qubit` now applies `GroverOperator` faster by not using its matrix representation but a
  custom rule for `apply_operation`. Also, the matrix representation of `GroverOperator` runs faster now.
  [(#4666)](https://github.com/PennyLaneAI/pennylane/pull/4666)

<h4>Other improvements</h4>

* Added `ops.functions.assert_valid` for checking if an `Operator` class is defined correctly.
  [(#4764)](https://github.com/PennyLaneAI/pennylane/pull/4764)

* Added `__eq__` method for TransformProgram and TransformContainers allowing the comparison of respective objects using `==` and `!=` operators.
  [(#4858)](https://github.com/PennyLaneAI/pennylane/pull/4858)

* `GlobalPhase` now decomposes to nothing, in case devices do not support global phases.
  [(#4855)](https://github.com/PennyLaneAI/pennylane/pull/4855)

* Custom operations can now provide their matrix directly through the `Operator.matrix()` method
  without needing to update the `has_matrix` property. `has_matrix` will now automatically be
  `True` if `Operator.matrix` is overridden, even if
  `Operator.compute_matrix` is not.
  [(#4844)](https://github.com/PennyLaneAI/pennylane/pull/4844)

* Simplified the logic for re-arranging states before returning.
  [(#4817)](https://github.com/PennyLaneAI/pennylane/pull/4817)

* When multiplying `SparseHamiltonian`s by a scalar value, the result stays as a 
  `SparseHamiltonian`.
  [(#4828)](https://github.com/PennyLaneAI/pennylane/pull/4828)

* `trainable_params` can now be set on initialization of `QuantumScript`, instead of having to set the
  parameter after initialization.
  [(#4877)](https://github.com/PennyLaneAI/pennylane/pull/4877)

* `default.qubit` now calculates the expectation value of Hermitians in a differentiable manner.
  [(#4866)](https://github.com/PennyLaneAI/pennylane/pull/4866)

* The `rot` decomposition now has support for returning a global phase.
  [(#4869)](https://github.com/PennyLaneAI/pennylane/pull/4869)

* The `"pennylane_sketch"` MPL-drawer style has been added. This is the same as the `"pennylane"`
  style, but with sketch-style lines.
  [(#4880)](https://github.com/PennyLaneAI/pennylane/pull/4880)

<h3>Breaking changes üíî</h3>

* The transforms submodule `qml.transforms.qcut` becomes its own module `qml.qcut`.
  [(#4819)](https://github.com/PennyLaneAI/pennylane/pull/4819)

* The decomposition of `GroverOperator` now has an additional global phase operation.
  [(#4666)](https://github.com/PennyLaneAI/pennylane/pull/4666)

* Moved `qml.cond` and the `Conditional` operation from the `transforms` folder to the `ops/op_math` folder.
  `qml.transforms.Conditional` will now be available as `qml.ops.Conditional`.
  [(#4860)](https://github.com/PennyLaneAI/pennylane/pull/4860)

* The `prep` keyword argument has been removed from `QuantumScript` and `QuantumTape`.
  `StatePrepBase` operations should be placed at the beginning of the `ops` list instead.
  [(#4756)](https://github.com/PennyLaneAI/pennylane/pull/4756)

* `qml.gradients.pulse_generator` has become `qml.gradients.pulse_odegen` to adhere to paper naming conventions.
  [(#4769)](https://github.com/PennyLaneAI/pennylane/pull/4769)

* Specifying `control_values` passed to `qml.ctrl` as a string is no longer supported.
  [(#4816)](https://github.com/PennyLaneAI/pennylane/pull/4816)

* The `rot` decomposition will now normalize its rotation angles to the range `[0, 4pi]` for consistency
  [(#4869)](https://github.com/PennyLaneAI/pennylane/pull/4869)

* `QuantumScript.graph` is now built using `tape.measurements` instead of `tape.observables`
  because it depended on the now-deprecated `Observable.return_type` property.
  [(#4762)](https://github.com/PennyLaneAI/pennylane/pull/4762)

* The `"pennylane"` MPL-drawer style now draws straight lines instead of sketch-style lines.
  [(#4880)](https://github.com/PennyLaneAI/pennylane/pull/4880)

<h3>Deprecations üëã</h3>

* `single_tape_transform`, `batch_transform`, `qfunc_transform`, and `op_transform` are deprecated.
  Instead switch to using the new `qml.transform` function.
  [(#4774)](https://github.com/PennyLaneAI/pennylane/pull/4774)

* `Observable.return_type` is deprecated. Instead, you should inspect the type
  of the surrounding measurement process.
  [(#4762)](https://github.com/PennyLaneAI/pennylane/pull/4762)
  [(#4798)](https://github.com/PennyLaneAI/pennylane/pull/4798)

* All deprecations now raise a `qml.PennyLaneDeprecationWarning` instead of a `UserWarning`.
  [(#4814)](https://github.com/PennyLaneAI/pennylane/pull/4814)

* `QuantumScript.is_sampled` and `QuantumScript.all_sampled` are deprecated.
  Users should now validate these properties manually.
  [(#4773)](https://github.com/PennyLaneAI/pennylane/pull/4773)

<h3>Documentation üìù</h3>

* Documentation for QCut was move to its own API page `qml.qcut`.
  [(#4819)](https://github.com/PennyLaneAI/pennylane/pull/4819)

* Documentation page for `qml.measurements` now links top-level accessible functions (e.g. `qml.expval`) 
  to their top-level pages (rather than their module-level pages, eg. `qml.measurements.expval`).
  [(#4750)](https://github.com/PennyLaneAI/pennylane/pull/4750)

* Added information to documentation of `qml.matrix` about wire ordering when using `qml.matrix` on a
  `QNode` which uses a device with `device.wires=None`.
  [(#4874)](https://github.com/PennyLaneAI/pennylane/pull/4874)

<h3>Bug fixes üêõ</h3>

* `qml.grad` and `qml.jacobian` now explicitly raise errors if trainable parameters are integers.
  [(#4836)](https://github.com/PennyLaneAI/pennylane/pull/4836)

* JAX JIT now works with shot vectors.
  [(#4772)](https://github.com/PennyLaneAI/pennylane/pull/4772/)

* JAX can now differentiate a batch of circuits where one tape does not have trainable parameters.
  [(#4837)](https://github.com/PennyLaneAI/pennylane/pull/4837)

* The decomposition of `GroverOperator` now has the same global phase as its matrix.
  [(#4666)](https://github.com/PennyLaneAI/pennylane/pull/4666)

* The `tape.to_openqasm` method no longer mistakenly includes interface information in the parameter 
  string when converting tapes using non-numpy interfaces.
  [(#4849)](https://github.com/PennyLaneAI/pennylane/pull/4849)

* `qml.defer_measurements` now correctly transforms circuits when terminal measurements include wires
  used in mid-circuit measurements.
  [(#4787)](https://github.com/PennyLaneAI/pennylane/pull/4787)

* Fixes a bug where the adjoint method differentiation would fail if
  an operation with `grad_method=None` that has a parameter is present.
  [(#4820)](https://github.com/PennyLaneAI/pennylane/pull/4820)
  
* `MottonenStatePreparation` now raises an error if decomposing a broadcasted state vector.
  [(#4767)](https://github.com/PennyLaneAI/pennylane/pull/4767)

* `BasisStatePreparation` now raises an error if decomposing a broadcasted state vector.
  [(#4767)](https://github.com/PennyLaneAI/pennylane/pull/4767)

* Gradient transforms now work with overridden shot vectors and default qubit.
  [(#4795)](https://github.com/PennyLaneAI/pennylane/pull/4795)

* Any `ScalarSymbolicOp`, like `Evolution`, now states that it has a matrix if the target
  is a `Hamiltonian`.
  [(#4768)](https://github.com/PennyLaneAI/pennylane/pull/4768)

* In `default.qubit`, initial states are now initialized with the simulator's wire order, not the circuit's
  wire order.
  [(#4781)](https://github.com/PennyLaneAI/pennylane/pull/4781)

* `transpile` can now handle measurements that are broadcasted onto all wires.
  [(#4793)](https://github.com/PennyLaneAI/pennylane/pull/4793)

* Parametrized circuits whose operators do not act on all wires return pennylane tensors as
  expected, instead of numpy arrays.
  [(#4811)](https://github.com/PennyLaneAI/pennylane/pull/4811)
  [(#4817)](https://github.com/PennyLaneAI/pennylane/pull/4817)

* `merge_amplitude_embeddings` no longer depends on queuing, allowing it to work as expected
  with QNodes.
  [(#4831)](https://github.com/PennyLaneAI/pennylane/pull/4831)

* `qml.pow(op)` and `qml.QubitUnitary.pow()` now also work with Tensorflow data raised to an
  integer power.
  [(#4827)](https://github.com/PennyLaneAI/pennylane/pull/4827)

* Fixed text drawer to correctly label qinfo measurements, as well as `qml.classical_shadow`
  `qml.shadow_expval`.
  [(#4803)](https://github.com/PennyLaneAI/pennylane/pull/4803)

* Using a `CNOT` or `PauliZ` operation with large, batched states and the tensorflow
  interface no longer raises an unexpected error.
  [(#4889)](https://github.com/PennyLaneAI/pennylane/pull/4889)

<h3>Contributors ‚úçÔ∏è</h3>

This release contains contributions from (in alphabetical order):

Guillermo Alonso,
Ali Asadi,
Thomas Bromley,
Astral Cai,
Isaac De Vlugt,
Amintor Dusko,
Lillian Frederiksen,
Josh Izaac,
Emiliano Godinez Ramirez,
Ankit Khandelwal,
Christina Lee,
Romain Moyard,
Vincent Michaud-Rioux,
Anurav Modak,
Mudit Pandey,
Matthew Silverman,
David Wierichs,
Justin Woodring,
